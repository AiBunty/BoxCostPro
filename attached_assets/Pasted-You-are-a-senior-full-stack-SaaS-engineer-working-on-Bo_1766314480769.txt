You are a senior full-stack SaaS engineer working on BoxCostPro.

GOAL:
Stabilize and professionalize the Quote system by adding:
1) Automated tests for quote save
2) Branded Quote PDF generation
3) Consistent quote reporting
4) Edit & version comparison UI

This must be production-ready and ERP-grade.

====================================================
1) AUTOMATED TESTS – QUOTE SAVE (CRITICAL)
====================================================

Create automated backend tests to ensure Quote Save never breaks again.

A) TEST SETUP
- Use existing test framework (Jest / Vitest)
- Create test file:
  backend/tests/quote.save.test.ts

B) TEST CASES
Write tests for:
1) Save new quote successfully
2) Save quote with multiple items
3) Save quote creates version = 1
4) Saving same quote again creates new version
5) Quote totals (subtotal, GST, transport, final total) persist correctly
6) Invalid payload returns 400
7) Transaction rollback on failure

C) ASSERTIONS
- Quote exists in DB
- Quote items count matches
- totalValue > 0
- activeVersionId updated
- No partial saves

====================================================
2) QUOTE PDF GENERATION (BRANDED)
====================================================

Implement professional Quote PDF generation.

A) BACKEND
Create endpoint:
GET /api/quotes/:id/pdf

Logic:
- Fetch quote + active version
- Fetch business profile
- Fetch items
- Calculate totals (do not trust client)

Use:
- PDFKit or Puppeteer

B) PDF DESIGN
Include:
- Business logo
- Business name & address
- Quote number & date
- Party name
- Item table (Qty, Rate, Amount)
- Subtotal, GST, Transport, Grand Total
- Payment terms
- Delivery timeline
- Footer: “Generated by BoxCostPro”

C) STORAGE
- Generate PDF on demand
- Optional: cache PDF for 24 hours

====================================================
3) QUOTE REPORTS CONSISTENCY (FIX ONCE, FOREVER)
====================================================

Ensure reports always match saved quotes.

A) BACKEND RULES
- Reports MUST read from:
  quotes.totalValue
  quotes.activeVersionId
- Never recalculate totals in reports

B) REPORT APIs
Ensure:
GET /api/quotes
GET /api/reports/quotes

Return:
- Quote number
- Party
- Version number
- Total value
- Date
- Status

C) CONSISTENCY CHECK
- If activeVersionId is null → fix automatically
- Never show version drafts in reports

====================================================
4) EDIT & VERSION COMPARISON UI (ERP STYLE)
====================================================

A) EDIT FLOW
- Editing a quote NEVER overwrites data
- Always creates a new version
- Previous versions are read-only

UI:
- “Edit Quote” → opens calculator with latest version
- Save → creates new version

B) VERSION HISTORY UI
Create component:
QuoteVersionHistory.tsx

Show:
- Version number
- Created date
- Created by
- Total value
- View button

C) VERSION COMPARISON
Create Compare View:
- Select Version A & Version B
- Side-by-side table comparison:
  Qty, Rate, Amount changes
- Highlight changed fields

====================================================
5) UX IMPROVEMENTS
====================================================

- Toast on save:
  “Quote saved successfully (Version X)”
- Badge:
  “Active Version”
- Tooltip explaining versioning
- Disable editing older versions

====================================================
6) SECURITY & QUALITY RULES
====================================================

- Only approved users can generate PDF
- Only owner can edit quote
- PDFs are read-only
- All changes logged

====================================================
DELIVERABLE
====================================================

After implementation:
- Quote Save is test-protected
- PDFs look professional & branded
- Reports always match saved data
- Version history is clear & usable
- ERP-grade quote lifecycle achieved
